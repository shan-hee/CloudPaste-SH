<!DOCTYPE html>
<html lang="zh" data-theme="auto">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CloudPaste - 分享内容</title>
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>📋</text></svg>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="share.css">
    <!-- 使用CDN加载QRCode库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <!-- 内联定义二维码相关函数 -->
    <script>
        function toggleQRCode(url) {
            console.log('生成二维码，URL:', url);
            
            let container = document.getElementById('qrcode-container');
            if (!container) {
                container = document.createElement('div');
                container.id = 'qrcode-container';
                container.className = 'qr-code-container';
                
                const modal = document.createElement('div');
                modal.className = 'qr-code-modal';
                
                const title = document.createElement('h3');
                title.textContent = '扫描二维码访问';
                
                const qrcodeDiv = document.createElement('div');
                qrcodeDiv.id = 'qrcode';
                qrcodeDiv.className = 'qr-code';
                
                const buttonContainer = document.createElement('div');
                buttonContainer.className = 'qr-code-actions';
                
                const downloadBtn = document.createElement('button');
                downloadBtn.textContent = '下载二维码';
                downloadBtn.className = 'download-btn';
                downloadBtn.onclick = () => {
                    const canvas = qrcodeDiv.querySelector('canvas');
                    if (canvas) {
                        const link = document.createElement('a');
                        link.download = 'qrcode.png';
                        link.href = canvas.toDataURL('image/png');
                        link.click();
                    }
                };
                
                const closeBtn = document.createElement('button');
                closeBtn.textContent = '关闭';
                closeBtn.className = 'close-btn';
                closeBtn.onclick = () => container.style.display = 'none';
                
                buttonContainer.appendChild(downloadBtn);
                buttonContainer.appendChild(closeBtn);
                
                modal.appendChild(title);
                modal.appendChild(qrcodeDiv);
                modal.appendChild(buttonContainer);
                container.appendChild(modal);
                document.body.appendChild(container);
                
                container.onclick = (e) => {
                    if (e.target === container) {
                        container.style.display = 'none';
                    }
                };
            }
            
            try {
                const qrcodeDiv = document.getElementById('qrcode');
                qrcodeDiv.innerHTML = '';
                
                // 创建QRCode实例
                const qrcode = new QRCode(qrcodeDiv, {
                    text: url,
                    width: 200,
                    height: 200
                });
                
                // 显示容器
                container.style.display = 'flex';
                
                console.log('二维码生成成功');
            } catch (error) {
                console.error('生成二维码失败:', error);
                alert('生成二维码失败，请稍后再试');
            }
        }
        
        // 兼容旧的函数名
        window.toggleQDCode = window.toggleQRCode = toggleQRCode;
        
        // 确保函数在全局作用域可用
        document.addEventListener('DOMContentLoaded', function() {
            console.log('页面加载完成，QRCode状态:', typeof QRCode);
        });
    </script>
    <!-- 最后加载其他脚本 -->
    <script src="app.js" defer></script>
    <script src="share.js" defer></script>
</head>
<body>
    <header class="header">
        <div class="theme-toggle" id="themeToggle">
            <i class="fas fa-sun"></i>
        </div>
    </header>
    
    <div class="content-container">
        <div class="content-card">
            <div class="card-header">
                <div class="left-actions">
                    <button class="action-btn" id="copyBtn">
                        <i class="fas fa-copy"></i>
                        复制内容
                    </button>
                    <button class="action-btn qr-btn" data-url="" title="显示二维码">
                        <i class="fas fa-qrcode"></i>
                        显示二维码
                    </button>
                    <button class="action-btn" id="editBtn">
                        <i class="fas fa-edit"></i>
                        编辑内容
                    </button>
                </div>
                <div class="right-actions">
                    <select class="format-select" id="formatSelect">
                        <option value="pdf" selected>PDF格式</option>
                        <option value="png">PNG格式</option>
                    </select>
                    <button class="action-btn" id="downloadBtn">
                        <i class="fas fa-download"></i>
                        导出
                    </button>
                </div>
            </div>
            
            <div class="card-content">
                <textarea class="share-content" id="shareContent" readonly></textarea>
            </div>
            
            <div class="info-group">
                <span class="info-item">
                    <i class="far fa-clock"></i>
                    创建时间: <span id="createTime"></span>
                </span>
                <span class="info-item">
                    <i class="far fa-eye"></i>
                    访问次数: <span id="viewCount">0</span>
                </span>
                <span class="info-item">
                    <i class="fas fa-hourglass-half"></i>
                    过期时间: <span id="expireTime"></span>
                </span>
            </div>
        </div>

        <!-- Toast提示元素 -->
        <div class="toast" id="toast">
            <i class="fas fa-check-circle"></i>
            <span>内容已复制到剪贴板</span>
        </div>
    </div>
</body>
</html> 